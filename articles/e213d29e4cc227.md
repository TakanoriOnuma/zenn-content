---
title: "MUIã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è‡ªä½œã—ã¦ä½¿ã†"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "transition", "mui"]
published: true
---

## å§‹ã‚ã«

MUIã¯ã„ãã¤ã‹ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæä¾›ã•ã‚Œã¦ãŠã‚Šã€ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ãŸã‚Š`TransitionComponent`ã¨ã„ã†Propsã«æ¸¡ã™ã“ã¨ã§ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://mui.com/material-ui/transitions

ã‚‚ã—æä¾›ã•ã‚Œã¦ã„ã‚‹ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ä»¥å¤–ã®ã‚‚ã®ã‚’ä½¿ã„ãŸã„å ´åˆã¯æ—¢å­˜ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ã‚’å‚è€ƒã«è‡ªä½œã™ã‚‹ã“ã¨ã§å®Ÿç¾ã§ãã¾ã™ãŒã€è‰²ã€…ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‹ã‚Œã¦ãŠã‚Šã€åˆè¦‹ã§ã¯ã‚µãƒƒãƒ‘ãƒªã§ã—ãŸ(æ±—)

https://github.com/mui/material-ui/blob/v5.14.14/packages/mui-material/src/Fade/Fade.js

ã—ã‹ã—ãƒ™ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã‚‹[react-transition-group](https://reactcommunity.org/react-transition-group/)ã«ã¤ã„ã¦èª¿ã¹ãŸã‚Šã€è‰²ã€…æ¤œè¨¼ã—ã¦ã„ãŸã“ã¨ã§å¤§ä½“ã¯ç†è§£ã§ãã¦è‡ªä½œã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã®ã§ã€å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚

`react-transition-group`è‡ªä½“ã«ã¤ã„ã¦ã¯ã“ã®è¨˜äº‹ã§ã¾ã¨ã‚ã¦ãŠã‚Šã€ã“ã®å†…å®¹ã‚’å…ƒã«MUIã§ã©ã†ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ã¨ã„ã†è©±ã‚’ã—ã¾ã™ã®ã§ã€äº‹å‰ã«èª­ã‚“ã§ãŠãã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

https://zenn.dev/numa_san/articles/219a3e815f6211

### ä»Šå›ä½œã£ãŸã‚‚ã®

ä»Šå›ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§ä½œã£ãŸã‚‚ã®ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªä¸‹ã‹ã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã™ã‚‹ã‚ˆã†ãªã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚’Snackbarã®`TransitionComponent`ã«æ¸¡ã—ã¦è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§ã‚„ã‚Šã¾ã—ãŸã€‚

![](/images/mui-custom-transition/custom-transition.gif)

![](/images/mui-custom-transition/snackbar-custom-transition.gif)

ã¾ãŸä»Šå›ä½œã£ãŸã‚‚ã®ã¯ä»¥ä¸‹ã®CodeSandboxã«ã‚ã‚Šã¾ã™ã®ã§ã€å‹•ãã‚„è©³ç´°ã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸã„æ–¹ã¯ã“ã¡ã‚‰ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

@[codesandbox](https://codesandbox.io/embed/muinotoranzisiyonkonponentowozi-zuo-suru-m99srs?fontsize=14&hidenavigation=1&theme=dark)

## MUIå‘ã‘ã®ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½œæˆ

ã¾ãšã¯ä»¥ä¸‹ã®è¨˜äº‹ã§ã‚‚ä½œã£ãŸã‚ˆã†ãªã€æœ€ä½é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚

https://zenn.dev/numa_san/articles/219a3e815f6211

```tsx:CustomTransitionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åœŸå°ã‚’ä½œã‚‹
import { TransitionProps } from "@mui/material/transitions";
import {
  useRef,
  CSSProperties,
  ReactElement
} from "react";
import { Transition, TransitionStatus } from "react-transition-group";

export type CustomTransitionProps = Omit<TransitionProps, "children"> & {
  children: ReactElement<any, any>;
};

const styles: Partial<Record<TransitionStatus, CSSProperties>> = {
  entering: {
    opacity: 1,
    transform: "none"
  },
  entered: {
    opacity: 1,
    transform: "none"
  },
  exiting: {
    transform: "translateY(-30px)"
  }
};

export const CustomTransition: FC<CustomTransitionProps> =
  (props) => {
    const {
      appear = true,
      children,
      in: inProp,
      timeout,
      ...other
    } = props;

    const nodeRef = useRef<HTMLElement | null>(null);

    return (
      <Transition
        appear={appear}
        in={inProp}
        nodeRef={nodeRef}
        timeout={timeout}
        {...other}
      >
        {(state) => {
          return (
            <div
              ref={nodeRef}
              style={{
                opacity: 0,
                transform: "translateY(30px)",
                // timeoutã®è¨­å®šãŒé›£ã—ã„ã®ã§ä¸€æ—¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã™ã‚‹
                transition: "opacity 250ms, transform 250ms",
                visibility: state === "exited" && !inProp ? "hidden" : undefined,
                ...styles[state],
              }}
            >
              {children}
            </div>
          )
        }}
      </Transition>
    );
  }
;
```

ã“ã‚Œã§ã‚‚æœ€ä½é™ã®å‹•ããŒã§ãã¾ã™ãŒã€ã“ã“ã‹ã‚‰MUIã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«åˆã‚ã›ã¦ã„ãã¾ã™ã€‚

### timeoutã‚’themeã‹ã‚‰å‚ç…§ã™ã‚‹

timeoutã¯MUIã®themeã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒã‚ã‚‹ãŸã‚ã€propsæœªæŒ‡å®šã®å ´åˆã¯ãã¡ã‚‰ã‚’å‚ç…§ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯enterã¨exitã§ã¯å€¤ãŒç•°ãªã£ã¦ã„ã‚‹ãŸã‚ã€transitionã‚’è¨­å®šã™ã‚‹éš›ã«ã“ã‚Œã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```ts:themeã«å«ã¾ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
const defaultTimeout = {
  enter: theme.transitions.duration.enteringScreen,
  exit: theme.transitions.duration.leavingScreen
}
// { enter: 225, exit: 195 }
```

ã“ã‚Œã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã®ã¯å¤§å¤‰ãªãŸã‚ã€MUIã§ã‚‚`getTransitionProps`, `theme.transitions.create`ã‚’ä½¿ã£ã¦ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³è¨­å®šã‚’ã—ã¦ã„ã¾ã™ã€‚

```diff tsx:timeoutã‚’themeã‹ã‚‰å‚ç…§ã™ã‚‹
+import { useTheme } from "@mui/material";
 import { TransitionProps } from "@mui/material/transitions";
+import { getTransitionProps } from "@mui/material/transitions/utils";
 import {
   useRef,
   CSSProperties,
   ReactElement
 } from "react";
 import { Transition, TransitionStatus } from "react-transition-group";

export const CustomTransition: FC<CustomTransitionProps> =
  (props) => {
+    const theme = useTheme();
+    const defaultTimeout = {
+      enter: theme.transitions.duration.enteringScreen,
+      exit: theme.transitions.duration.leavingScreen
+    };

     const {
       appear = true,
       children,
+      easing,
       in: inProp,
+      style,
-      timeout,
+      timeout = defaultTimeout,
       ...other
     } = props;

     const nodeRef = useRef<HTMLElement | null>(null);

     return (
       <Transition
         appear={appear}
         in={inProp}
         nodeRef={nodeRef}
         timeout={timeout}
         {...other}
       >
         {(state) => {
+          const transitionProps = getTransitionProps(
+            { style, timeout, easing },
+            {
+              // TODO: enterã¨exitã‚’stateã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹
+              mode: "enter"
+            }
+          );
+
+          const transition = theme.transitions.create(
+            ["opacity", "transform"],
+            transitionProps
+          );
           return (
             <div
               ref={nodeRef}
               style={{
                 opacity: 0,
                 transform: "translateY(30px)",
-                // timeoutã®è¨­å®šãŒé›£ã—ã„ã®ã§ä¸€æ—¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã™ã‚‹
-                transition: "opacity 250ms, transform 250ms",
+                transition,
                 visibility: state === "exited" && !inProp ? "hidden" : undefined,
                 ...styles[state],
               }}
             >
               {children}
             </div>
           )
         }}
       </Transition>
     );
   }
 ;
```

https://github.com/mui/material-ui/blob/v5.14.14/packages/mui-material/src/transitions/utils.ts#L21-L33

### ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’propsã§å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

`Transition`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¯`onEnter`ã‚„`onEntered`ãªã©ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒã‚ã‚Šã¾ã™ãŒã€è‡ªä½œã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒé©åˆ‡ã§ã€MUIã‚‚ã“ã®å¯¾å¿œãŒã•ã‚Œã¦ã„ã¾ã™ã€‚
ã—ã‹ã—ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®å®šç¾©ã¯æ€ã£ã¦ã„ãŸã‚ˆã‚Šã‚‚æ‰‹é–“ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹å ´åˆã‚‚ã‚ã‚Šã€ãã®æ™‚ã«propsã‹ã‚‰æ¸¡ã•ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã‚±ã‚¢ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã“ã®éƒ¨åˆ†ãŒä¸€ç•ªã‚³ãƒ¼ãƒ‰é‡ãŒå¤šã„ï¼‰ã€‚ã“ã‚Œã‚’MUIã§ã¯`normalizedTransitionCallback`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã£ã¦ã€ãã“ã‹ã‚‰`handle~`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œã£ã¦`Transition`ã®propsã«æ¸¡ã—ã¦ã„ã¾ã™ã€‚
`transition`styleã®è¨­å®šã‚‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å´ã«ç§»å‹•ã™ã‚‹ã“ã¨ã§`enter`ã¨`exit`ã®åˆ‡ã‚Šæ›¿ãˆãŒå®¹æ˜“ã«ãªã‚‹ã®ã§ãã¡ã‚‰ã«ç§»å‹•ã—ã¾ã™ã€‚ã¾ãŸã€`webkit`ã‚’è€ƒæ…®ã—ã¦ã‹`style.webkitTransition`ã«ã‚‚è¨­å®šã•ã‚Œã¦ã„ãŸã®ã§åŒã˜ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸã€‚

```diff tsx:ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’propsã§å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
 import { useTheme } from "@mui/material";
 import { TransitionProps } from "@mui/material/transitions";
 import { getTransitionProps, reflow } from "@mui/material/transitions/utils";
 import {
   useRef,
   CSSProperties,
   ReactElement
 } from "react";
 import { Transition, TransitionStatus } from "react-transition-group";

 export const CustomTransition =
   (props) => {
     const theme = useTheme();
     const defaultTimeout = {
       enter: theme.transitions.duration.enteringScreen,
       exit: theme.transitions.duration.leavingScreen
     };

     const {
+      addEndListener,
       appear = true,
       children,
       easing,
       in: inProp,
+      onEnter,
+      onEntered,
+      onEntering,
+      onExit,
+      onExited,
+      onExiting,
       style,
       timeout = defaultTimeout,
       ...other
     } = props;

     const nodeRef = useRef<HTMLElement | null>(null);

+    const normalizedTransitionCallback = (
+      callback?:
+        | ((node: HTMLElement) => void)
+        | ((node: HTMLElement, isAppearing: boolean) => void)
+    ) => (maybeIsAppearing?: boolean) => {
+      const node = nodeRef.current;
+      if (node == null || callback == null) {
+        return;
+      }
+
+      // onEnterXxx and onExitXxx callbacks have a different arguments. length value.
+      if (maybeIsAppearing === undefined) {
+        // å‹ã‚¨ãƒ©ãƒ¼è§£æ¶ˆã®ãŸã‚ã€å‚ç…§ã•ã‚Œãªã„ç¬¬äºŒå¼•æ•°ã¨ã¨ã‚Šã‚ãˆãšå…¥ã‚Œã¦ãŠã
+        callback(node, false);
+      } else {
+        callback(node, maybeIsAppearing);
+      }
+    };

+    const handleEntering = normalizedTransitionCallback(onEntering);

+    const handleEnter = normalizedTransitionCallback((node, isAppearing) => {
+      reflow(node); // So the animation always start from the start.
+
+      const transitionProps = getTransitionProps(
+        { style, timeout, easing },
+        {
+          mode: "enter"
+        }
+      );
+
+      node.style.webkitTransition = theme.transitions.create(
+        ["opacity", "transform"],
+        transitionProps
+      );
+      node.style.transition = theme.transitions.create(
+        ["opacity", "transform"],
+        transitionProps
+      );
+
+      if (onEnter) {
+        onEnter(node, isAppearing);
+      }
+    });

+    const handleEntered = normalizedTransitionCallback(onEntered);

+    const handleExiting = normalizedTransitionCallback(onExiting);

+    const handleExit = normalizedTransitionCallback((node: HTMLElement) => {
+      const transitionProps = getTransitionProps(
+        { style, timeout, easing },
+        {
+          mode: "exit"
+        }
+      );
+
+      node.style.webkitTransition = theme.transitions.create(
+        ["opacity", "transform"],
+        transitionProps
+      );
+      node.style.transition = theme.transitions.create(
+        ["opacity", "transform"],
+        transitionProps
+      );
+
+      if (onExit) {
+        onExit(node);
+      }
+    });

+    const handleExited = normalizedTransitionCallback(onExited);

+    const handleAddEndListener = (next: () => void) => {
+      if (addEndListener && nodeRef.current != null) {
+        // Old call signature before `react-transition-group` implemented `nodeRef`
+        addEndListener(nodeRef.current, next);
+      }
+    };

     return (
       <Transition
         appear={appear}
         in={inProp}
         nodeRef={nodeRef}
+        onEnter={handleEnter}
+        onEntered={handleEntered}
+        onEntering={handleEntering}
+        onExit={handleExit}
+        onExited={handleExited}
+        onExiting={handleExiting}
+        addEndListener={handleAddEndListener}
         timeout={timeout}
         {...other}
       >
         {(state) => {
-          // handleEnter, handleExitã§transition styleã‚’è¨­å®šã™ã‚‹ã®ã§ã“ã“ã¯å‰Šé™¤
-          const transitionProps = getTransitionProps(
-            { style, timeout, easing },
-            {
-              // TODO: enterã¨exitã‚’stateã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹
-              mode: "enter"
-            }
-          );
-
-          const transition = theme.transitions.create(
-            ["opacity", "transform"],
-            transitionProps
-          );
           return (
             <div
               ref={nodeRef}
               style={{
                 opacity: 0,
                 transform: "translateY(30px)",
-                transition,
                 visibility: state === "exited" && !inProp ? "hidden" : undefined,
                 ...styles[state],
               }}
             >
               {children}
             </div>
           )
        }}
      </Transition>
    );
  }
;
```

:::details reflowã«ã¤ã„ã¦

`handleEnter`ã«ã¯æœ€åˆã«`reflow`ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚

```tsx
const handleEnter = normalizedTransitionCallback((node, isAppearing) => {
  reflow(node); // So the animation always start from the start.

  const transitionProps = getTransitionProps(
    { style, timeout, easing },
    {
      mode: "enter",
    }
  );

  node.style.webkitTransition = theme.transitions.create(
    ["opacity", "transform"],
    transitionProps
  );
  node.style.transition = theme.transitions.create(
    ["opacity", "transform"],
    transitionProps
  );

  if (onEnter) {
    onEnter(node, isAppearing);
  }
});
```

MUIã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã‚‹ã¨ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/mui/material-ui/blob/v5.14.14/packages/mui-material/src/transitions/utils.ts#L3

Reflowã¨ã„ã†ã®ã¯ç°¡å˜ã«è¨€ã†ã¨JSã®å®Ÿè¡Œä¸­ã«DOMã®å†è¨ˆç®—ã‚’è¡Œã†ã‚‚ã®ã§ã€é€šå¸¸ã¯é¿ã‘ãŸæ–¹ãŒè‰¯ã„ã‚‚ã®ã§ã™ã€‚ã—ã‹ã—ã‚ãˆã¦å†è¨ˆç®—ã•ã›ã‚‹ã“ã¨ã§ã€ãã‚Œä»¥é™ã®DOMè¨­å®šãŒæœ€æ–°ã®çŠ¶æ…‹ã«ãªã‚‹ã®ã§æ„å›³ã—ã¦ã‚„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
æ­£ç›´æœ¬å½“ã«å¿…è¦ã‹ã¯åˆ†ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€MUIã§ã¯æ›¸ã‹ã‚Œã¦ã„ãŸã®ã§åŒã˜ã‚ˆã†ã«æ›¸ãã¾ã—ãŸã€‚
:::

### ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹divè¦ç´ ã‚’ãªãã™

`Transition`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§renderã™ã‚‹éš›ã«styleã‚„refã‚’æ¸¡ã™ã‚ˆã†ã«divè¦ç´ ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ã„ã¾ã—ãŸãŒã€MUIã§ã¯ãƒ©ãƒƒãƒ—ã›ãšã«`closeElement`ã§ç›´æ¥childrenã«å…¥ã£ã¦ã„ã‚‹ReactElementã«å¯¾ã—ã¦propsã‚’æµã—è¾¼ã¿ã¾ã™ã€‚

:::message
ã“ã®å®Ÿè£…ã«ã‚ˆã£ã¦`Transition`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç³»ã®ã‚‚ã®ã¯`forwardRef`ã‚„`style`ã‚’å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒå¿…é ˆã«ãªã‚Šã¾ã™ã€‚

https://mui.com/material-ui/transitions/#child-requirement
:::

```diff tsx:divè¦ç´ ã‚’ãªãã—ã¦cloneElementã§propsã‚’æµã—è¾¼ã‚€
 import { useTheme } from "@mui/material";
+import { useForkRef } from "@mui/material";
 import { TransitionProps } from "@mui/material/transitions";
 import { getTransitionProps, reflow } from "@mui/material/transitions/utils";
 import {
+  cloneElement,
   useRef,
   CSSProperties,
   ReactElement
 } from "react";
 import { Transition, TransitionStatus } from "react-transition-group";

 export const CustomTransition: FC<CustomTransitionProps> =
   (props) => {
     // ä¸€éƒ¨çœç•¥

     const nodeRef = useRef<HTMLElement | null>(null);
+    const handleRef = useForkRef(
+      nodeRef,
+      // å‘¼ã³å‡ºã—å´ã§childrenã«refã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã«ãã¡ã‚“ã¨refãŒæ¸¡ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®š
+      // @ts-ignore childrenã«refã®å‹ãŒãªã‹ã£ãŸã®ã§ã¨ã‚Šã‚ãˆãšignoreã™ã‚‹
+      children.ref
+    );

     // ä¸€éƒ¨çœç•¥

     return (
       <Transition
         // å¤‰æ›´ãŒãªã„ãŸã‚çœç•¥
       >
+        {(state, childProps) => {
-        {(state) => {
-          return (
-            <div
-              ref={nodeRef}
-              style={{
-                opacity: 0,
-                transform: "translateY(30px)",
-                transition,
-                visibility: state === "exited" && !inProp ? "hidden" : undefined,
-                ...styles[state],
-              }}
-            >
-              {children}
-            </div>
-          )
+          return cloneElement(children, {
+            style: {
+              opacity: 0,
+              transform: "translateY(30px)",
+              visibility: state === "exited" && !inProp ? "hidden" : undefined,
+              ...styles[state],
+              ...style,
+              ...children.props.style
+            },
+            ref: handleRef,
+            ...childProps
+          });
         }}
       </Transition>
     );
   }
 ;
```

`children`ã®å†…å®¹ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹ãŸã‚ã€`ref`ã‚„`style`ãªã©ã®è¨­å®šãŒãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`style`ã«ã¤ã„ã¦ã¯`children.props.style`ã§ä¸¡æ–¹è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒï¼ˆ`opacity`ãªã©ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§ä½¿ã£ã¦ã„ã‚‹styleã‚’è¨­å®šã—ã¦ã—ã¾ã†ã¨ä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„ã¾ã™ãŒã€‚ã€‚ï¼‰ã€`ref`ã®æ–¹ã¯ä¸€å·¥å¤«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
MUIã§ã¯åŒã˜ã‚‚ã®ã«`ref`ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«`useForkRef`hooksã‚’ç”¨æ„ã—ã¦ã„ã‚‹ãŸã‚ã€ãã‚Œã‚’å‘¼ã¶ã“ã¨ã§ä¸¡æ–¹ã«refãŒè¨­å®šã•ã‚Œã‚‹ã‚ˆã†ã«ã§ãã¾ã™ã€‚

https://github.com/mui/material-ui/blob/v5.14.14/packages/mui-utils/src/useForkRef/useForkRef.ts

:::details childrenãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ã‚‹childPropsã«ã¤ã„ã¦
`Transition`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚ã‚‹childrenãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯æ›¸ã‹ã‚Œã¦ã„ã¾ã›ã‚“ãŒå®Ÿã¯ç¬¬äºŒå¼•æ•°ãŒã‚ã‚‹ã‚ˆã†ã§ã€MUIã§ã¯ãã‚Œã‚’è€ƒæ…®ã—ãŸæ›¸ãæ–¹ã‚’ã—ã¦ã„ãŸã®ã§åˆã‚ã›ã¾ã—ãŸã€‚

https://reactcommunity.org/react-transition-group/transition#Transition-prop-children

```tsx
<Transition>
  {(state, childProps) => {
    //
  }}
</Transition>
```

`childProps`ã¯ã©ã†ã„ã†æ™‚ã«æ¸¡ã›ã‚‹ã‹ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãŸã¨ã“ã‚ã€ã©ã†ã‚„ã‚‰`Transition`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ä½™åˆ†ã«propsã‚’æ¸¡ã—ãŸæ™‚ã«å­ä¾›ã«ä¸­ç¶™ã™ã‚‹ã‚ˆã†ã§ã™ã€‚ã“ã®æ›¸ãæ–¹ã¯typeã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã¨æ€ã†ã®ã§åŸºæœ¬çš„ã«ã¯ä½¿ã‚ãªã„ã¨æ€ã‚ã‚Œã¾ã™ã€‚

https://github.com/reactjs/react-transition-group/blob/v4.4.5/src/Transition.js#L377-L384

:::

### ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«refã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹

æœ€å¾Œã«ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè‡ªèº«ã‚‚`forwardRef`ã‚’ä½¿ã£ã¦refã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚æ­£ç›´ä½¿ã†æ©Ÿä¼šãŒä»Šä¸€åˆ†ã‹ã‚Šã¾ã›ã‚“ãŒã€ä»–ã®MUIãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãã†ã„ã†ä½œã‚Šã‚’ã—ã¦ã„ãŸã®ã§åˆã‚ã›ã¾ã—ãŸã€‚MUIã§ã¯childrenã®refã«å…¥ã‚‹ã‚ˆã†ã«`handleRef`ã«å«ã‚ã¦ã„ã¾ã—ãŸã€‚

```diff tsx:ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚forwardRefã‚’ä½¿ã£ã¦refã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
 import { useForkRef, useTheme } from "@mui/material";
 import { TransitionProps } from "@mui/material/transitions";
 import { getTransitionProps, reflow } from "@mui/material/transitions/utils";
 import {
   cloneElement,
+  forwardRef,
   useRef,
   CSSProperties,
   ReactElement
 } from "react";
 import { Transition, TransitionStatus } from "react-transition-group";

-export const CustomTransition: FC<CustomTransitionProps> =
-  (props) => {
+export const CustomTransition = forwardRef<HTMLElement, CustomTransitionProps>(
+  (props, ref) => {
     // ä¸€éƒ¨çœç•¥

     const nodeRef = useRef<HTMLElement | null>(null);
     const handleRef = useForkRef(
       nodeRef,
       // å‘¼ã³å‡ºã—å´ã§childrenã«refã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã«ãã¡ã‚“ã¨refãŒæ¸¡ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®š
       // @ts-ignore childrenã«refã®å‹ãŒãªã‹ã£ãŸã®ã§ã¨ã‚Šã‚ãˆãšignoreã™ã‚‹
       children.ref,
+      ref
     );

     // ä¸€éƒ¨çœç•¥
   }
+);
```

## çµ‚ã‚ã‚Šã«

ä»¥ä¸ŠãŒMUIã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è‡ªä½œã™ã‚‹æ–¹æ³•ã§ã—ãŸã€‚MUIã§ã¯è‰²ã€…ãªã‚±ãƒ¼ã‚¹ã‚’è€ƒæ…®ã—ã¦ä½œã‚‰ã‚Œã¦ã„ãŸã®ã§ãã‚Œã«åˆã‚ã›ã‚‹ã®ã¯ã‹ãªã‚Šå¤§å¤‰ã§ã—ãŸãŒã€`useForkRef`ã¨ã‹`normalizedTransitionCallback`ã¨ã‹MUIã®å®Ÿè£…ã®æ·±ã„ã¨ã“ã‚ã‚’çŸ¥ã‚Œã¦è‰¯ã‹ã£ãŸãªã¨æ€ã„ã¾ã—ãŸã€‚
MUIã§ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è‡ªä½œã—ãŸã„æ™‚ã®å‚è€ƒã«ãªã‚Œã‚Œã°å¹¸ã„ã§ã™ã€‚
