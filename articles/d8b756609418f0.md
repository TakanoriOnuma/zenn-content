---
title: "React Routerã§Search Paramsã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã‚’æ¥½ã«ã™ã‚‹hooksã‚’ä½œã£ã¦ã¿ãŸ"
emoji: "ğŸ“š"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "reactrouter"]
published: true
---

## å§‹ã‚ã«

ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®é–‹é–‰ãƒ•ãƒ©ã‚°ã‚„ã‚¿ãƒ–ã®è¡¨ç¤ºå ´æ‰€ãªã©ã®çŠ¶æ…‹ã‚’`useState`ã§ç®¡ç†ã™ã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚Œã‚’ã™ã‚‹ã¨ç”»é¢ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ãŸã‚ŠURLã‚’å…±æœ‰ã—ã¦ã‚‚åˆæœŸçŠ¶æ…‹ãŒè¡¨ç¤ºã•ã‚Œã¦ã—ã¾ã„ã€çŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚URLã®å¾Œã‚ã« `?open=true` ã¿ãŸã„ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»•è¾¼ã¿ã€ãã‚Œã‚’å…ƒã«ã™ã‚‹ã¨ç›®çš„ã¯æœãŸã•ã‚Œã¾ã™ãŒã€å‹ãŒå½“ãŸã‚‰ãªã„ã®ã¨å®Ÿè£…ãŒãã“ãã“å†—é•·ã«ãªã‚Šã€ã“ã‚Œã‚’æ¯å›æ›¸ãã®ã¯å„„åŠ«ã§ã™ã€‚

```tsx:ç›´æ¥useSearchParamsã‚’ä½¿ã£ã¦ãƒ•ãƒ©ã‚°ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ä¾‹
import { useSearchParams } from 'react-router';

export const DialogPage = () => {
  const [searchParams, setSearchParams] = useSearchParams();

  const isOpen = searchParams.get('open') === 'true'
  const updateIsOpen = (newIsOpen: boolean) => {
    searchParams((prevSearchParams) => {
      if (newIsOpen === true) {
        prevSearchParams.set('open', true);
      } else {
        prevSearchParams.delete('open');
      }
      return prevSearchParams;
    });
  }

  return (
    //
  )
}
```

å…ƒã€…ã‚„ã‚ŠãŸã„ã“ã¨ã¯çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã‹ã‚‰URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ç®¡ç†ã™ã‚‹ã ã‘ã§ã€åˆ©ç”¨ã™ã‚‹å´ã¯`useState`ã¨åŒã˜æ„Ÿè¦šã§æ‰±ãˆãŸã‚‰ä¾¿åˆ©ã ãªã¨æ€ã„ã€ãã‚ŒãŒã§ãã‚‹ã‚ˆã†ãªhooksã‚’ä½œã£ã¦ã¿ãŸã®ã§è¨˜äº‹ã«ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

## useStateã¨åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§SearchParamsã‚’æ›´æ–°ã™ã‚‹hooksã®å®Ÿè£…

çµè«–ã‹ã‚‰è¨€ã†ã¨ä»¥ä¸‹ã®hooksãŒSearchParamsã‚’ä½¿ã£ãŸã©ã®ã‚±ãƒ¼ã‚¹ã«ã‚‚å¯¾å¿œã§ãã‚‹æ±ç”¨çš„ãªhooksã«ãªã‚Šã¾ã™ã€‚ã“ã“ã‹ã‚‰æ›´ã«ãƒ©ãƒƒãƒ—ã—ã¦booleanç”¨ã€stringç”¨ãªã©ã‚’ä½œã‚‹ã¨ã‚ˆã‚Šä½¿ã„ã‚„ã™ã„hooksã«ãªã‚Šã¾ã™ğŸ˜„ æ¬¡ã‹ã‚‰ã„ãã¤ã‹ä¾‹ã‚’æŒ™ã’ã¦ã„ãã¾ã™ã€‚

```ts:ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
import { useCallback, SetStateAction } from 'react';
import { useSearchParams } from 'react-router';

/**
 * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
 */
export const useStateBySearchParams = <T>({
  parser,
  updater,
}: {
  /**
   * searchParamsã‹ã‚‰ç›®çš„ã®å€¤ã«ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
   * @param searchParams - URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
   */
  parser: (searchParams: URLSearchParams) => T;
  /**
   * searchParamsã®æ›´æ–°å‡¦ç†
   * @param newValue - æ–°ã—ã„å€¤
   * @param searchParams - URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
   */
  updater: (newValue: T, searchParams: URLSearchParams) => URLSearchParams;
}) => {
  const [searchParams, setSearchParams] = useSearchParams();

  const value = parser(searchParams);

  const setValue = useCallback(
    (valueOrFunc: SetStateAction<T>) => {
      setSearchParams(
        (prevSearchParams) => {
          const prevValue = parser(prevSearchParams);
          const newValue: T =
            typeof valueOrFunc === 'function'
              ? // @ts-ignore ä¸Šæ‰‹ãå‹ã®çµã‚Šè¾¼ã¿ãŒã•ã‚Œãªã‹ã£ãŸã®ã§ignoreã™ã‚‹
                valueOrFunc(prevValue)
              : valueOrFunc;

          const newSearchParams = updater(newValue, prevSearchParams);
          return newSearchParams;
        }
      );
    },
    [parser, updater]
  );

  return [value, setValue] as const;
};
```

### ãƒ•ãƒ©ã‚°ã‚’SearchParamsã§ç®¡ç†ã™ã‚‹hooks

å…ˆã»ã©å®Ÿè£…ã—ãŸ `useStateBySearchParams` ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ãƒ•ãƒ©ã‚°(boolean)ã«ç‰¹åŒ–ã—ãŸhooksã‚’ä½œã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã§å¼•æ•°ã¯æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚­ãƒ¼åã‚’æ¸¡ã™ã ã‘ã§è‰¯ããªã‚Šã€ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªhooksã«ãªã‚Šã¾ã™ã€‚

```ts:booleanã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
/**
 * booleanã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
 */
const useBooleanStateBySearchParams = ({
  key,
}: {
  /** URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹ã‚­ãƒ¼ */
  key: string;
}) => {
  return useStateBySearchParams({
    parser: (searchParams) => {
      return searchParams.get(key) === 'true';
    },
    updater: (newFlag, searchParams) => {
      if (newFlag === true) {
        searchParams.set(key, 'true');
      } else {
        searchParams.delete(key);
      }
      return searchParams;
    },
  });
};
```

ä½¿ç”¨ä¾‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã€ReturnTypeã‚’`useState`ã¨åˆã‚ã›ã¦ã„ã‚‹ãŸã‚ã€ä»£ã‚ã‚Šã«ã“ã®hooksã«æ›¸ãå¤‰ãˆã‚‹ã ã‘ã§å®Ÿè£…ã§ãã¾ã™ğŸ˜Š

```diff tsx:SearchParamsã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–‹é–‰ãƒ•ãƒ©ã‚°ã®çŠ¶æ…‹ç®¡ç†ã‚’ã™ã‚‹ä¾‹
 export const DialogPage: FC = () => {
-  const [isOpen, setIsOpen] = useState(false);
+  const [isOpen, setIsOpen] = useBooleanStateBySearchParams({ key: 'open' });

   return (
     <div>
       <h3>ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ç”»é¢</h3>
       <Button
         variant="contained"
         onClick={() => {
           setIsOpen(true);
         }}
       >
         é–‹ã
       </Button>
       <Dialog
         open={isOpen}
         PaperProps={{
           sx: {
             width: '80%',
           },
         }}
         onClose={() => {
           setIsOpen(false);
         }}
       >
         <DialogTitle>ãƒ€ã‚¤ã‚¢ãƒ­ã‚°</DialogTitle>
         <DialogContent>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</DialogContent>
         <DialogActions>
           <Button
             onClick={() => {
               setIsOpen(false);
             }}
           >
             é–‰ã˜ã‚‹
           </Button>
         </DialogActions>
       </Dialog>
     </div>
   );
 }
```

### æ–‡å­—åˆ—ã‚’SearchParamsã§ç®¡ç†ã™ã‚‹hooks

æ–‡å­—åˆ—ã®å ´åˆã¯`string`å‹ã ã‘ã§ã¯ãªã`'tab1' | 'tab2' | 'tab3'`ã®ã‚ˆã†ãªãƒ¦ãƒ‹ã‚ªãƒ³ãƒªãƒ†ãƒ©ãƒ«å‹ã«ã‚‚å¯¾å¿œã™ã‚‹ã‚ˆã†ã«æ›¸ãã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:æ–‡å­—åˆ—ã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
/**
 * æ–‡å­—åˆ—ã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
 */
export const useStringStateBySearchParams = function <T extends string>({
  key,
  allowValues,
  defaultValue,
}: {
  /** URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹ã‚­ãƒ¼ */
  key: string;
  /** å—ã‘å…¥ã‚Œå¯èƒ½ãªå€¤ */
  allowValues?: T[];
  /** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ */
  defaultValue: T;
}) {
  return useStateBySearchParams({
    parser: (searchParams): T => {
      const value = searchParams.get(key);
      if (value == null) {
        return defaultValue;
      }
      if (allowValues == null) {
        return value as T;
      }
      return allowValues.includes(value as T) ? (value as T) : defaultValue;
    },
    updater: (newValue, searchParams) => {
      if (newValue === defaultValue) {
        searchParams.delete(key);
      } else {
        searchParams.set(key, newValue);
      }
      return searchParams;
    },
  });
};
```

ä½¿ç”¨ä¾‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã€ã‚¿ãƒ–IDãŒæ±ºã¾ã£ã¦ã„ã‚‹å ´åˆã®å‹æ¨è«–ã‚‚ä¸Šæ‰‹ãã§ãã¦ãŠã‚Šã¾ã™ğŸ˜Š

```tsx:SearchParamsã§ã‚¿ãƒ–IDã®çŠ¶æ…‹ç®¡ç†ã‚’ã™ã‚‹ä¾‹
const TAB_ITEMS = [
  { value: 'tab1', label: 'ã‚¿ãƒ–ï¼‘' },
  { value: 'tab2', label: 'ã‚¿ãƒ–ï¼’' },
  { value: 'tab3', label: 'ã‚¿ãƒ–ï¼“' },
] as const;
const TAB_IDS = TAB_ITEMS.map((item) => item.value);
type TabId = (typeof TAB_IDS)[number];

export const TabsPage: FC = () => {
  const [tabId, setTabId] = useStringStateBySearchParams({
    key: 'tab',
    allowValues: TAB_IDS,
    defaultValue: 'tab1',
  });

  return (
    <div>
      <h3>ã‚¿ãƒ–ç”»é¢</h3>
      <Tabs
        value={tabId}
        variant="fullWidth"
        onChange={(_, value: TabId) => {
          setTabId(value);
        }}
      >
        {TAB_ITEMS.map((tabItem) => (
          <Tab
            key={tabItem.value}
            value={tabItem.value}
            label={tabItem.label}
          />
        ))}
      </Tabs>
      <div>tab: {tabId}</div>
    </div>
  );
};
```

ãªãŠã€å˜ç´”ã«stringå‹ã§å–å¾—ã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚

```ts:å˜ç´”ã«stringå‹ã§å–å¾—ã™ã‚‹ä¾‹
const Page = () => {
  // å¤‰ãªå‹æ¨è«–ãŒã•ã‚Œã¦ã—ã¾ã†ãŸã‚ã€<string>ã¨å‹ã‚’æ˜è¨˜ã™ã‚‹
  const [keyword, setKeyword] = setStringStateBySearchParams<string>({
    key: 'keyword',
    defaultValue: ''
  })
}
```

### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’SearchParamsã§ç®¡ç†ã™ã‚‹hooks

ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã¯zodãªã©ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§æ¥½ã«å‹æ¨è«–ã‚„ãƒ‘ãƒ¼ã‚¹å‡¦ç†ãŒè¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts:Objectã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
import { z } from 'zod',
import { isEqual } from 'lodash-es';

/**
 * Objectã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
 */
const useObjectStateBySearchParams = <Schema extends z.ZodSchema>({
  key,
  schema,
  defaultValue,
}: {
  /** URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹ã‚­ãƒ¼ */
  key: string;
  /** Zodã‚¹ã‚­ãƒ¼ãƒ */
  schema: Schema;
  /** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ */
  defaultValue: z.infer<Schema>;
}) => {
  return useStateBySearchParams({
    parser: (searchParams): z.infer<Schema> => {
      const value = searchParams.get(key);
      try {
        const json = JSON.parse(value ?? '');
        return schema.parse(json);
      } catch {
        return defaultValue;
      }
    },
    updater: (newValue, searchParams) => {
      if (isEqual(newValue, defaultValue)) {
        searchParams.delete(key);
      } else {
        searchParams.set(key, JSON.stringify(newValue));
      }
      return searchParams;
    },
  });
};
```

ä½¿ç”¨ä¾‹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã‚¹ã‚­ãƒ¼ãƒã•ãˆå®šç¾©ã™ã‚Œã°ä½•ã§ã‚‚å¯¾å¿œã§ãã‚‹ã®ã§é…åˆ—ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚æ›¸ã„ã¦ã„ã¾ã™ã€‚ï¼ˆé…åˆ—ã‚‚JSã§ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨èªè­˜ã•ã‚Œã‚‹ã®ã§ã“ã“ã§ä¸€ç·’ã«ã‚„ã£ã¡ã‚ƒã„ã¾ã™ï¼‰
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã£ã¦ã—ã‹ã‚‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒ3ç¨®é¡ã‚‚ã‚ã£ã¦è¤‡é›‘ã«ãªã£ã¦ã„ã¾ã™ãŒã€`useState`ã¨åŒã˜ãã‚‰ã„ã®ä½¿ç”¨æ„Ÿã«ã¾ã§ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ãŸã“ã¨ã§ãƒ­ã‚¸ãƒƒã‚¯ã®è¦‹é€šã—ã‚‚è‰¯ã„ã§ã™ã­ğŸ˜Š

```tsx:SearchParamsã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚½ãƒ¼ãƒˆã®çŠ¶æ…‹ç®¡ç†ã‚’ã™ã‚‹ä¾‹
const sortModelSchema = z.array(
  z
    .object({
      field: z.string(),
      sort: z.enum(['asc', 'desc']).nullable().optional(),
    })
    // optionalã ã‘å¤–ã—ã¦undefinedã ã‘æ®‹ã™ãƒãƒƒã‚¯
    // @see https://stackoverflow.com/a/74650249
    .transform((obj) => ({ ...obj, sort: obj.sort }))
) satisfies z.ZodType<GridSortModel, any, any>;

const paginationModelSchema = z.object({
  page: z.number(),
  pageSize: z.number(),
}) satisfies z.ZodType<GridPaginationModel, any, any>;
const DEFAULT_PAGINATION_MODEL: GridPaginationModel = {
  page: 0,
  pageSize: 5,
};

export const TablePage: FC = () => {
  const [keyword, setKeyword] = useStringStateBySearchParams<string>({
    key: 'keyword',
    defaultValue: '',
  });
  const [sortModel, setSortModel] = useObjectStateBySearchParams({
    key: 'sortModel',
    schema: sortModelSchema,
    defaultValue: [],
  });
  const [paginationModel, setPaginationModel] = useObjectStateBySearchParams({
    key: 'paginationModel',
    schema: paginationModelSchema,
    defaultValue: DEFAULT_PAGINATION_MODEL,
  });

  const filteredPeople = useMemo(() => {
    return PEOPLE.filter((person) => {
      if (person.id.toString().includes(keyword)) {
        return true;
      }
      if (person.name.includes(keyword)) {
        return true;
      }
      const sexLabel = person.sexType === 'male' ? 'ç”·æ€§' : 'å¥³æ€§';
      if (sexLabel.includes(keyword)) {
        return true;
      }
      if (person.email.includes(keyword)) {
        return true;
      }
      return false;
    });
  }, [keyword]);

  return (
    <div>
      <h3>Tableç”»é¢</h3>
      <Box sx={{ mb: 1 }}>
        <DebouncedKeyword
          keyword={keyword}
          onChangeDebouncedKeyword={(newKeyword) => {
            setKeyword(newKeyword);
          }}
        />
      </Box>
      <DataGrid
        rows={filteredPeople}
        columns={columns}
        slotProps={{
          pagination: {
            sx: {
              '& .MuiTablePagination-selectLabel': {
                display: 'block',
              },
              '& .MuiTablePagination-input': {
                display: 'inline-flex',
              },
            },
          },
        }}
        disableColumnFilter
        disableColumnSelector
        sortModel={sortModel}
        onSortModelChange={(newModel) => {
          setSortModel(newModel);
        }}
        pageSizeOptions={[5, 10]}
        paginationModel={paginationModel}
        onPaginationModelChange={(newModel) => {
          setPaginationModel(newModel);
        }}
      />
    </div>
  );
};
```

### URL historyã‚’pushã§ã¯ãªãreplaceã«ã—ãŸã„å ´åˆ

ã“ã‚Œã¾ã§ã®SearchParamsã®æ›´æ–°ã¯ã„ã‚ã‚†ã‚‹router.pushçš„ãªhistoryã‚’è¿½åŠ ã™ã‚‹è¡Œç‚ºã§ã—ãŸãŒã€å…ˆã»ã©ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚ˆã†ãªä¾‹ã ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰ãˆã‚‹ãŸã³ã«pushã•ã‚Œã‚‹ã®ã¯å¾®å¦™ã§ã™ã‚ˆã­ã€‚ã“ã‚Œã‚’replaceã«ã—ãŸã„å ´åˆã¯`setSearchParams`ã«`replace`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§OKã§ã™ã€‚ã“ã‚Œã‚’ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹hookså´ã§ã‚‚`replace`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¦ãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã™ã‚‹ã“ã¨ã§replaceã§æ›´æ–°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```diff ts:pushã§ã¯ãªãreplaceã§SearchParamsã‚’æ›´æ–°ã§ãã‚‹ã‚ˆã†ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
 import { useCallback, SetStateAction } from 'react';
 import { useSearchParams } from 'react-router';

 /**
  * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã‚’URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ç®¡ç†ã™ã‚‹hooks
  */
 export const useStateBySearchParams = <T>({
   parser,
   updater,
+  replace,
 }: {
   /**
    * searchParamsã‹ã‚‰ç›®çš„ã®å€¤ã«ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
    * @param searchParams - URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    */
   parser: (searchParams: URLSearchParams) => T;
   /**
    * searchParamsã®æ›´æ–°å‡¦ç†
    * @param newValue - æ–°ã—ã„å€¤
    * @param searchParams - URLæ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    */
   updater: (newValue: T, searchParams: URLSearchParams) => URLSearchParams;
+  /** historyã®æ›´æ–°ã‚’replaceã™ã‚‹ã‹ï¼ˆæœªå®šç¾©ã®å ´åˆã¯pushï¼‰ */
+  replace?: boolean;
 }) => {
   const [searchParams, setSearchParams] = useSearchParams();

   const value = parser(searchParams);

   const setValue = useCallback(
     (valueOrFunc: SetStateAction<T>) => {
       setSearchParams(
         (prevSearchParams) => {
           const prevValue = parser(prevSearchParams);
           const newValue: T =
             typeof valueOrFunc === 'function'
               ? // @ts-ignore ä¸Šæ‰‹ãå‹ã®çµã‚Šè¾¼ã¿ãŒã•ã‚Œãªã‹ã£ãŸã®ã§ignoreã™ã‚‹
                 valueOrFunc(prevValue)
               : valueOrFunc;

           const newSearchParams = updater(newValue, prevSearchParams);
           return newSearchParams;
         },
+       {
+          replace,
+        }
       );
     },
-    [parser, updater]
+    [parser, updater, replace]
   );

   return [value, setValue] as const;
 };
```

## çµ‚ã‚ã‚Šã«

ä»¥ä¸ŠãŒReactRouterã§Search Paramsã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã‚’æ¥½ã«ã™ã‚‹hooksã®å®Ÿè£…ã§ã—ãŸã€‚ãã‚Œãã‚Œã®å‹ã«åˆã‚ã›ãŸhooksã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§`useState`ã¨ã»ã¼åŒã˜æ„Ÿè¦šã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã€æ°—è»½ã«ä½¿ã„ã‚„ã™ããªã£ãŸãªã¨æ„Ÿã˜ã¾ã—ãŸğŸ˜Š

æœ€å¾Œã«æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã‚’StackBlitzã«ç½®ã„ã¦ã„ã¦ä»¥ä¸‹ã«è²¼ã£ã¦ãŠãã®ã§èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯æ˜¯éã”è¦§ãã ã•ã„ã€‚
Search Paramsã§çŠ¶æ…‹ç®¡ç†ã™ã‚‹éš›ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-41qd1tmb?ctl=1&embed=1&file=src%2Fhooks%2FuseStateBySearchParams.ts&view=preview)
