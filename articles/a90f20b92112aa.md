---
title: "Reactã§RerenderãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ã™ã‚‹"
emoji: "ğŸ¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react"]
published: true
---

# å§‹ã‚ã«

Reactã§ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒéå¸¸ã«ã‚·ãƒ“ã‚¢ã§ã€ä½•ã‚‚è€ƒãˆãªã„ã¨æ¯å›rerenderã•ã‚Œã¦ã—ã¾ã„å‹•ããŒã‹ãªã‚Šé‡ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã„ã¤rerenderãŒèµ°ã£ã¦ã„ã‚‹ã‹ãƒ‘ãƒƒã¨è¦‹ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ä¸­ã€…æ°—ã¥ã‘ã¾ã›ã‚“ã€‚rerenderã®æ¤œå‡ºã¯React Developer Toolsã§ä»¥ä¸‹ã®è¨˜äº‹ãªã©ã‚’å‚è€ƒã™ã‚‹ã“ã¨ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://dev.classmethod.jp/articles/react-developer-tools/

ä¸Šè¨˜ã®è¨­å®šã§ã»ã¨ã‚“ã©ã¯äº‹è¶³ã‚Šã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€CodeSandboxä¸Šã ã¨ä¸Šæ‰‹ãç¢ºèªã§ããªã‹ã£ãŸã‚Šã€renderå›æ•°ã‚’è¡¨ç¤ºã—ãŸã‚Šãªã©è‡ªåˆ†ã§è‰²ã€…ã„ã˜ã‚ŠãŸã„å ´åˆã¯è‡ªä½œã—ãŸæ–¹ãŒè‰¯ã„ã®ã§ã€ãã®æ–¹æ³•ã«ã¤ã„ã¦å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚

# renderã®å›æ•°ã‚’è¡¨ç¤ºã™ã‚‹

renderã®å›æ•°ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ã€å˜ç´”ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®renderãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã°ã‚ŒãŸå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚ãŸã  `useState` ã ã¨æ›´æ–°ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã¶ã¨ã¾ãŸrerenderã—ã¦ã—ã¾ã†ãŸã‚ã€`useRef`ã§ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

```tsx:renderã®å›æ•°ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
import { FC, useRef } from "react";

export const RenderCount: FC = () => {
  const renderCountRef = useRef(0);

  renderCountRef.current += 1;

  return <div>render count: {renderCountRef.current}</div>;
};
```

:::message
`React.StrictMode`ã§renderã—ã¦ã„ã‚‹å ´åˆã€é–‹ç™ºä¸­ã¯ä½™åˆ†ã«renderã‚’å®Ÿè¡Œã™ã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ã‚«ã‚¦ãƒ³ãƒˆãŒ2ã¤ãšã¤å¢—ãˆã¦ã—ã¾ã†ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
:::

# renderæ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºã™ã‚‹

renderå›æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã¯è‰¯ã„ã“ã¨ã§ã™ãŒã€`React.StrictMode`ã§renderã—ã¦ã„ã‚‹å ´åˆã¯ä½™è¨ˆã«renderã•ã‚Œã¦æœ¬ç•ªã§renderã•ã‚Œã‚‹å›æ•°ãŒåˆ†ã‹ã‚Šã¥ã‚‰ããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚å˜ç´”ã«rerenderã•ã‚ŒãŸã‹ã‚’å¯è¦–åŒ–ã™ã‚‹ã«ã¯ä»¥ä¸‹ã®è¨˜äº‹ã®ã‚ˆã†ã«ãƒ•ã‚§ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹ã®ãŒè‰¯ã•ãã†ã§ã™ã€‚ãŸã å…·ä½“çš„ãªå®Ÿè£…ãŒã“ã®è¨˜äº‹ã‹ã‚‰ã§ã¯è¦‹ã¤ã‘ã‚‰ã‚Œãªã‹ã£ãŸã®ã§è‡ªå·±æµã§å®Ÿè£…ã—ã¾ã—ãŸã€‚

https://alexsidorenko.com/blog/react-render-always-rerenders/

## CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…

ã¾ãšæœ€åˆã«æ€ã„æµ®ã‹ã¶ã®ã¯CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªCSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ãŸã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰è¡¨ç¤ºã§ããã†ã§ã™ã€‚

```scss:ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
@keyframes fadeOut {
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
    transform: translateY(-10px);
  }
}

.Item {
  animation: fadeOut 1s forwards;
  color: red;
}
```

ã‚ã¨ã¯rerenderã™ã‚‹ãŸã³ã«ã“ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒç™ºç«ã™ã‚Œã°è‰¯ã„ã§ã™ãŒã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ç™ºç«ã•ã›ã‚‹æ–¹æ³•ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§ `key` ã‚’æ›´æ–°ã—ã¦DOMè‡ªä½“ã‚’ä½œã‚Šç›´ã™æ–¹æ³•ã«ã—ã¾ã—ãŸã€‚å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç´¹ä»‹ã—ãŸrenderå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹ã‚„ã‚Šæ–¹ã‚’ä½¿ã£ã¦ãã®æ•°ã‚’ `key` ã«è¨­å®šã™ã‚‹ã“ã¨ã§æ¯å›é•ã†DOMã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã€ç›®çš„ã‚’é”æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```tsx:keyã‚’æ›´æ–°ã—ã¦CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¯å›å®Ÿè¡Œã•ã›ã‚‹
import { FC, useRef } from "react";

import styles from "./NotifyRerender.module.scss";

export const NotifyRerender: FC = () => {
  const renderedCountRef = useRef(0);

  renderedCountRef.current += 1;

  return (
    <div
      // keyã‚’å¤‰æ›´ã—ã¦æ¯å›DOMã‚’ä½œã‚Šç›´ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç™ºå‹•ã•ã›ã‚‹
      key={renderedCountRef.current}
      className={styles.Item}
    >
      Rerender
    </div>
  );
};
```

## Web Animations APIã§å®Ÿè£…

CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆã ã¨CSSãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ãŸã‚Šã€keyã§DOMã‚’å†ç”Ÿæˆã—ãŸã‚Šã™ã‚‹å¿…è¦ãŒã‚ã£ã¦å‰²ã¨æ‰‹é–“ã ã£ãŸã®ã§åˆ¥ãªæ–¹æ³•ã‚‚è€ƒãˆã¾ã—ãŸã€‚JSã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã™ã‚‹å ´åˆã¯ä»Šã ã¨[Web Animations API](https://developer.mozilla.org/ja/docs/Web/API/Web_Animations_API/Using_the_Web_Animations_API)ã¨ã„ã†ã‚‚ã®ãŒä½¿ãˆã‚‹ãŸã‚ã€ãã®ã‚„ã‚Šæ–¹ã‚‚è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚
`useEffect`ã§ç¬¬äºŒå¼•æ•°ã‚’æ¸¡ã•ãªã„å ´åˆã¯æ¯å›å®Ÿè¡Œã•ã‚Œã‚‹ä»•æ§˜ã‚’æ´»ã‹ã—ã€DOMã•ãˆå–å¾—ã§ãã‚Œã°effectã™ã‚‹ãŸã³ã«animateãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§è‰¯ã•ãã†ã§ã™ã€‚

```tsx:Web Animations APIã‚’ä½¿ã£ã¦ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºã™ã‚‹
import { FC, useRef, useEffect } from "react";

export const NotifyRerenderByWebAnim: FC = () => {
  const elRootRef = useRef<HTMLDivElement | null>(null);

  useEffect(() => {
    if (elRootRef.current == null) {
      return;
    }

    elRootRef.current.animate(
      [
        { opacity: 1, transform: "translateY(0)" },
        { opacity: 0, transform: "translateY(-10px)" }
      ],
      {
        duration: 500,
        fill: "forwards"
      }
    );
  });

  return (
    <div ref={elRootRef} style={{ color: "red" }}>
      Rerender
    </div>
  );
};
```

# å‹•ä½œç¢ºèª

CodeSandboxã§æ¤œè¨¼ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã—ãŸã®ã§ä»¥ä¸‹ã«è²¼ã£ã¦ãŠãã¾ã™ã€‚ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯renderå›æ•°ãŒä½™åˆ†ã«å¢—ãˆã‚‹ã¨åˆ†ã‹ã‚Šã¥ã‚‰ã‹ã£ãŸã®ã§`React.StrictMode`ã¯æ¶ˆã—ã¦ã„ã¾ã™ã€‚ã¾ãŸä¸€ã¤ã ã‘ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¡ãƒ¢åŒ–ã—ã¦rerenderãŒæŠ‘åˆ¶ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‚ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

@[codesandbox](https://codesandbox.io/embed/rerendersiteirukotogafen-karuyounisuru-87kqn4?fontsize=14&hidenavigation=1&theme=dark)

# çµ‚ã‚ã‚Šã«

ä»¥ä¸ŠãŒReactã®rerenderã‚’å¯è¦–åŒ–ã™ã‚‹æ–¹æ³•ã§ã—ãŸã€‚Reactã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã‚·ãƒ“ã‚¢ã«å‡ºã‚‹ã®ã§è‡ªå‰ã§ã‚‚ç¢ºèªã™ã‚‹è¡“ã‚’çŸ¥ã‚Œã¦è‰¯ã‹ã£ãŸã§ã™ã€‚è‡ªä½œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é…ç½®ã™ã‚‹å ´åˆã¯ç’°å¢ƒå¤‰æ•°ã§é–‹ç™ºä¸­ã ã‘è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ãŸã‚‰æœ¬ç•ªã«å½±éŸ¿ã¯å‡ºãªã„ã¨æ€ã†ã®ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ã‚·ãƒ“ã‚¢ã«ãƒã‚§ãƒƒã‚¯ã—ãŸã„å ´åˆã«ä»•è¾¼ã‚“ã§ãŠãã¨è‰¯ã„ã‹ã‚‚ã§ã™ã€‚
åŸºæœ¬çš„ã«ã¯React Developer Toolsã‚’è¨­å®šã™ã‚‹ã ã‘ã§ååˆ†ãã†ã§ã™ãŒã€ã‚‚ã—è‡ªä½œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’é…ç½®ã—ã¦ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„æ™‚ãŒã‚ã‚Šã¾ã—ãŸã‚‰å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
