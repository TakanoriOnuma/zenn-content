---
title: "Cloudflare Workersã‚’GitHub Actionsã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹(ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLè¡¨ç¤ºã‚„Deploymentsç™»éŒ²ä»˜ã)"
emoji: "ğŸŒ¤ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["cloudflare", "githubactions"]
published: true
---

## å§‹ã‚ã«

ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®é¸æŠè‚¢ã®ä¸€ã¤ã«CloudflareãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã¨ã—ã¦ã‚‚ä½¿ãˆã‚‹Cloudflare Workersã¯é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯èª²é‡‘å¯¾è±¡ã«å«ã¾ã‚Œãšç°¡å˜ãªAPIã¨çµ„ã¿åˆã‚ã›ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚‚ã§ãã€ã‹ãªã‚Šå„ªç§€ã ã¨æ€ã£ã¦ã„ã¾ã™ã€‚
Cloudflareã‹ã‚‰GitHubã¨é€£æºã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã™ã‚‹ã®ãŒä¸€ç•ªæ¥½ã§ã™ãŒã€GitHub Actionsã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚GitHub Actionsã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹è¨˜äº‹ãŒã‚ã‚Šã¾ã—ãŸãŒã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã‚’ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹æ–¹æ³•ãŒãªã‹ã£ãŸã‚Šã‚ã£ãŸã¨ã—ã¦ã‚‚å†—é•·ãªè¨­å®šã§ã‚‚ã†ã¡ã‚‡ã£ã¨è‰¯ã„æ–¹æ³•ãŒãªã„ã‹æ¨¡ç´¢ã—ã¦ãŠã‚Šã¾ã—ãŸã€‚
æ™®æ®µ [Netlifyã®GitHub Actions](https://github.com/nwtgck/actions-netlify) ã‚’ä½¿ã£ã¦ãŠã‚Šã€ãã‚Œã¨åŒã˜ã‚ˆã†ã«ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’æœ‰ã™ã‚‹GitHub Actionsã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ããŸã®ã§ã€ãã®æ–¹æ³•ã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚

- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã‚’GitHub PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
- GitHub Deploymentsã«ç™»éŒ²

### ä½œã£ãŸã‚‚ã®

ä»Šå›æ¤œè¨¼ç”¨ã§Cloudflareã®KVã‚’ä½¿ã£ãŸTODOãƒªã‚¹ãƒˆã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚å®Ÿè£…ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚
https://zenn.dev/azukiazusa/articles/hono-cloudflare-workers-rest-api

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã¯Vue3ã§TanStack Queryã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¾ã—ãŸãŒæœ¬é¡Œã‹ã‚‰é€¸ã‚Œã‚‹ã®ã§å®Ÿè£…å†…å®¹ã¯å‰²æ„›ã—ã¾ã™ã€‚è©³ç´°æ°—ã«ãªã‚‹æ–¹ã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã”å‚ç…§ãã ã•ã„ã€‚

https://github.com/TakanoriOnuma/trial-cloudflare-todo-list

ã¾ãŸãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚

https://trial-cloudflare-todo-list.numa-san-1024.workers.dev/

## Cloudflare Workersã‚’GitHub Actionsã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

### ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«GitHub Actionsã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã‚’ç™»éŒ²

GitHub Actionsã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯APIãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ã¾ãšã¯ãã‚Œã‚’ç”¨æ„ã—ã¦ã„ãã¾ã™ã€‚

#### APIãƒˆãƒ¼ã‚¯ãƒ³ã®ä½œæˆ

Manage Account > Account API Tokensã«é·ç§»ã—ã¦ã€ã€ŒCreate Tokenã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![](/images/cloudflare-github-actions/create-api-token-1.png)

ãã“ã§ã€ŒEdit Cloudflare Workersã€ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã™ã€‚
![](/images/cloudflare-github-actions/create-api-token-2.png)

ã“ã®ã¾ã¾ä½œæˆã§ã‚‚å•é¡Œãªã„ã§ã™ãŒã€Token nameã‚’ç·¨é›†ã—ã¦ãŠãã¨è­˜åˆ¥ã—ã‚„ã™ããªã‚‹ã¨æ€ã„ã¾ã™ã€‚
![](/images/cloudflare-github-actions/create-api-token-3.png)

ä½œæˆã—ãŸã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§Copyã‚’æŠ¼ã—ã¦ã‚³ãƒ”ãƒ¼ã—ã€`CLOUDFLARE_API_TOKEN`ãªã©ã®åå‰ã§GitHubã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã«ç™»éŒ²ã—ã¾ã™ã€‚
![](/images/cloudflare-github-actions/create-api-token-4.png)

#### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã®å–å¾—

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã®å‚ç…§ã¯çµæ§‹ç°¡å˜ã§ã€Workers&Pagesã®ã¨ã“ã‚ã«ã‚ã‚Šã¾ã™ã€‚ã“ã“ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦`CLOUDFLARE_ACCOUNT_ID`ãªã©ã®åå‰ã§GitHubã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã«ç™»éŒ²ã—ã¾ã™ã€‚
![](/images/cloudflare-github-actions/account-id.png)

### GitHub Actionsã§productionãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ã¾ãšã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã¯ãªãproductionãƒ‡ãƒ—ãƒ­ã‚¤ã‚’GitHub Actionsã‹ã‚‰è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ã¯é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚ã¾ãŸä»Šå›ã®æ¤œè¨¼ã§ã¯ãƒ¢ãƒãƒ¬ãƒã§å®Ÿè£…ã—ãŸã®ã§`workingDirectory`ã‚’è¨­å®šã—ã¦ã¾ã™ãŒã€ç›´ä¸‹ã«ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹å ´åˆã¯è¨­å®šä¸è¦ã§ã™ã€‚ãªãŠã€Workeråã¯`wrangler.jsonc`ãªã©ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å‚ç…§ã•ã‚Œã€äº‹å‰ã«ä½œã£ã¦ã„ãªã„å ´åˆã¯å‹æ‰‹ã«æ–°è¦ã§ä½œã‚‰ã‚Œã¾ã™ã€‚

```yml:Cloudflare Workersã‚’productionãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹
name: Deploy to Cloudflare Workers

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-22.04
    timeout-minutes: 10

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version-file: "package.json"
          cache: "npm"

      - name: Install dependencies
        run: npm install

      - name: Build Web App
        run: npm run w:web build

      - name: Deploy to Cloudflare Workers In Production Mode
        if: ${{ github.event_name == 'push' }}
        id: deploy
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          workingDirectory: server
          command: "deploy"
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}
```

### GitHub Actionsã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹

ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã€ãã®URLã‚’PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹é †ãŒå¿…è¦ã§ã™ã€‚

1. ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã®å®šç¾©ã¨æœ€çµ‚çš„ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹ä»˜ãURLã‚’ä¿å­˜
[å…¬å¼ã®Preview URLs](https://developers.cloudflare.com/workers/configuration/previews/) ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€ãã‚Œã«åˆã‚ã›ã¦URLã‚’å®šç¾©ã—ã¾ã™ã€‚ä¸€åº¦envã«ãã‚Œãã‚Œå®šç¾©ã™ã‚‹ã¨èª­ã¿ã‚„ã™ããªã‚‹ã¨æ€ã„ã¾ã™ã€‚
`<VERSION_PREFIX OR ALIAS>-<WORKER_NAME>.<SUBDOMAIN>.workers.dev`

2. ã‚¨ã‚¤ãƒªã‚¢ã‚¹åæŒ‡å®šã§ãƒ‡ãƒ—ãƒ­ã‚¤
`versions upload --preview-alias [ã‚¨ã‚¤ãƒªã‚¢ã‚¹å]`ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ãŒã§ãã¾ã™ã€‚ã‚¨ã‚¤ãƒªã‚¢ã‚¹åã¯ãªã‚“ã§ã‚‚è‰¯ã„ã§ã™ãŒã€Netlifyã«åˆã‚ã›ã¦ã“ã“ã§ã¯`deploy-preview-[PRç•ªå·]`ã«ã—ã¦ã„ã¾ã™ã€‚

3. ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸçµæœã‚’PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
[thollander/actions-comment-pull-request](https://github.com/thollander/actions-comment-pull-request)ã‚’ä½¿ã£ã¦PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã—ã¾ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆã®URLã¯`outputs.deployment-url`ã§å–å¾—ã§ãã¾ã™ãŒã€ã“ã¡ã‚‰ã¯ãƒ‡ãƒ—ãƒ­ã‚¤ã”ã¨ã«ç•°ãªã‚‹URLã§ã‚¨ã‚¤ãƒªã‚¢ã‚¹è¨­å®šã—ãŸURLã¯æ®‹å¿µãªãŒã‚‰å–å¾—ã§ããªã„ã®ã§1.ã§ä¿å­˜ã—ãŸURLã‚’ä½¿ã£ã¦å‡ºåŠ›ã—ã¾ã™ã€‚

ã“ã‚Œã‚’å…·ä½“çš„ã«ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```diff yml:ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
 name: Deploy to Cloudflare Workers

 on:
   push:
     branches:
       - main
+  pull_request:

+permissions:
+  pull-requests: write

 jobs:
   build-and-deploy:
     runs-on: ubuntu-22.04
     timeout-minutes: 10

     steps:
       - uses: actions/checkout@v4

       - uses: actions/setup-node@v4
         with:
           node-version-file: "package.json"
           cache: "npm"

       - name: Install dependencies
         run: npm install

       - name: Build Web App
         run: npm run w:web build

       - name: Deploy to Cloudflare Workers In Production Mode
         if: ${{ github.event_name == 'push' }}
         id: deploy
         uses: cloudflare/wrangler-action@v3
         with:
           apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
           accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
           workingDirectory: server
           command: "deploy"
           gitHubToken: ${{ secrets.GITHUB_TOKEN }}

+      - name: Alias Deployment URL
+        if: ${{ github.event_name == 'pull_request' }}
+        id: alias
+        run: |
+          echo "name=${ALIAS_NAME}" >> $GITHUB_OUTPUT
+          echo "url=https://${ALIAS_NAME}-${WORKER_NAME}.${SUBDOMAIN}.workers.dev" >> $GITHUB_OUTPUT
+        env:
+          ALIAS_NAME: deploy-preview-${{ github.event.pull_request.number }}
+          WORKER_NAME: trial-cloudflare-todo-list
+          SUBDOMAIN: numa-san-1024
+
+      - name: Deploy to Cloudflare Workers In Preview Mode
+        if: ${{ github.event_name == 'pull_request' }}
+        id: deploy-preview
+        uses: cloudflare/wrangler-action@v3
+        with:
+          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
+          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
+          workingDirectory: server
+          command: "versions upload --preview-alias ${{ steps.alias.outputs.name }}"
+          gitHubToken: ${{ secrets.GITHUB_TOKEN }}
+
+      - name: Comment Preview URL
+        if: ${{ github.event_name == 'pull_request' }}
+        uses: thollander/actions-comment-pull-request@v3
+        with:
+          message: |
+            ğŸš€ Deployed to Cloudflare Workers
+            Preview URL: ${{ steps.alias.outputs.url }}
+            <sub>Deployment URL: ${{ steps.deploy-preview.outputs.deployment-url }}</sub>
+          comment-tag: "cloudflare-workers-deployment"
```

å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚åŸºæœ¬çš„ã«ã¯Preview URLã®æ–¹ã‚’å‚ç…§ã™ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã‚³ãƒŸãƒƒãƒˆã”ã¨ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å‚ç…§ã—ãŸã„å ´åˆã¯ä¸‹ã®ãƒªãƒ³ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨è‰¯ã„ã§ã™ã€‚

![](/images/cloudflare-github-actions/preview-url-in-github-pr.png)

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã« `"preview_urls": true` ãŒã‚ã‚‹ã¨å‹æ‰‹ã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ãŒONã«ã•ã‚Œã‚‹ã‚‰ã—ã„ã®ã§ã™ãŒã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒæ‚ªã‹ã£ãŸã®ã‹ä¸Šæ‰‹ãè¡¨ç¤ºã§ããªã‹ã£ãŸã®ã§ã€ãã®æ™‚ã¯è¨­å®šç”»é¢ã‹ã‚‰Enableã‚’æŠ¼ã—ã¦æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚

![](/images/cloudflare-github-actions/enable-preview-urls.png)

#### ä½™è«‡: KVã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ã¤ã„ã¦

Cloudflareã®KVã«ã¯preview_idã¨ã„ã†è¨­å®šãŒã‚ã‚Šã¾ã™ãŒã€ã‚ã‚Œã¯`versions upload`ã§ã¯å‚ç…§ã•ã‚Œãšæœ¬ç•ªã®KVã®æ–¹ãŒä½¿ã‚ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚è»½ãèª¿ã¹ãŸæ„Ÿã˜æ–¹æ³•ãŒåˆ†ã‹ã‚‰ãªã‹ã£ãŸã®ã§ChatGPTã«èã„ãŸã¨ã“ã‚ã€ã¡ã‚ƒã‚“ã¨ã‚„ã‚‹ã«ã¯ãã‚‚ãã‚‚`env`ã«previewç”¨ã‚’ç”¨æ„ã™ã‚‹ã¨è‰¯ã„ã‚‰ã—ãã€preview_idã¯å»ƒæ­¢æ–¹å‘ã«ãªã‚‹ã¨ã®ã“ã¨ã§ã—ãŸã€‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã¡ã‚ƒã‚“ã¨èª­ã‚“ã ã‚ã‘ã§ã¯ãªã„ã®ã§çœŸå®Ÿã¯å®šã‹ã§ã¯ãªã„ã§ã™ãŒã€ç¢ºã‹ã«`env`ã§previewç”¨ã‚’ç”¨æ„ã—ãŸæ–¹ãŒä»–ã®ã‚±ãƒ¼ã‚¹ã«ã‚‚å¯¾å¿œã§ãã‚‹ã—ãã£ã¡ã«å¯„ã›ãŸæ–¹ãŒè‰¯ã•ãã†ã ãªãã¨æ„Ÿã˜ã¾ã—ãŸã€‚ã“ã®è¾ºã¯ä»Šå›é‡è¦ãªã¨ã“ã‚ã§ã¯ãªã„ãŸã‚ä¸€æ—¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã§ã‚‚æœ¬ç•ªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹çŠ¶æ…‹ã«ãªã£ã¦ã„ã¾ã™ã€‚

### GitHub Deploymentsã«ç™»éŒ²

æœ€å¾Œã«GitHub Deploymentsã«ã‚‚ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã‚’ã™ã‚‹ã¨GitHubãƒªãƒã‚¸ãƒˆãƒªã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¤‡æ•°ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹å ´åˆã¯ã“ã“ã§ä¸€è¦§ã§ãã‚‹ã®ã¯ä¾¿åˆ©ãã†ã§ã™ã€‚

![](/images/cloudflare-github-actions/github-deployments.png)

GitHub Actionsã‚’ä½¿ã£ã¦ç™»éŒ²ã™ã‚‹å ´åˆã¯ [chrnorm/deployment-action](https://github.com/chrnorm/deployment-action)ã¨[chrnorm/deployment-status](https://github.com/chrnorm/deployment-status)ã‚’ä½¿ã†ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã§ã§ãã¾ã™ã€‚å°‘ã—æ‰‹é–“ã§ã™ãŒä¸€åº¦ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ ã‚’ä½œæˆã—ã¦ã€ãã“ã«successã‹failureã‹æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```diff yml:GitHub Deploymentsã«ç™»éŒ²
 name: Deploy to Cloudflare Workers

 on:
   push:
     branches:
       - main
   pull_request:

 permissions:
   pull-requests: write
+  deployments: write

 jobs:
   build-and-deploy:
     runs-on: ubuntu-22.04
     timeout-minutes: 10

     steps:
       - uses: actions/checkout@v4

       - uses: actions/setup-node@v4
         with:
           node-version-file: "package.json"
           cache: "npm"

       - name: Install dependencies
         run: npm install

       - name: Build Web App
         run: npm run w:web build

       - name: Deploy to Cloudflare Workers In Production Mode
         if: ${{ github.event_name == 'push' }}
         id: deploy
         uses: cloudflare/wrangler-action@v3
         with:
           apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
           accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
           workingDirectory: server
           command: "deploy"
           gitHubToken: ${{ secrets.GITHUB_TOKEN }}

+      - name: Create GitHub Deployment
+        if: ${{ github.event_name == 'push' }}
+        id: deployment
+        uses: chrnorm/deployment-action@v2
+        with:
+          token: ${{ secrets.GITHUB_TOKEN }}
+          environment: "Cloudflare Workers Production"
+
+      - name: Set Deployment Status
+        if: ${{ github.event_name == 'push' }}
+        uses: chrnorm/deployment-status@v2
+        with:
+          token: ${{ secrets.GITHUB_TOKEN }}
+          state: "success"
+          deployment-id: ${{ steps.deployment.outputs.deployment_id }}
+          environment-url: ${{ steps.deploy.outputs.deployment-url }}

       # pull_requestã®ã‚¹ãƒ†ãƒƒãƒ—ã¯çœç•¥
```

## çµ‚ã‚ã‚Šã«

ä»¥ä¸ŠãŒCloudflare Workersã‚’GitHub Actionsã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ã§ã—ãŸã€‚Netlifyã®GitHub Actionsã®ã‚ˆã†ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‡ºã—ãŸã‚ŠDeploymentsã«ç™»éŒ²ã™ã‚‹ã¨ã“ã‚ã‚‚ã‚„ã‚ã†ã¨ã™ã‚‹ã¨å‰²ã¨æ›¸ãã“ã¨ãŒã‚ã£ã¦ã€ã“ã®è¾ºã‚‚ãƒãƒ«ã£ã¨ã‚„ã£ã¦ãã‚Œã¦ã‹ãªã‚Šã‚ã‚ŠãŒãŸã‹ã£ãŸãªãã¨æ„Ÿã˜ã¾ã—ãŸã€‚ãŸã ç–çµåˆã®è¦³ç‚¹ã‹ã‚‰ã™ã‚‹ã¨éå‰°ãªæ°—ã¯ã—ã¦ã‚ãã¾ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹éƒ¨åˆ†ã ã‘ã‚„ã‚‹ã®ãŒæ™®é€šãªã‚“ã ã‚ã†ãªã¨æ„Ÿã˜ã¦ãŠã‚Šã€ä»–ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã§ã‚‚ä»Šå›è¨­å®šã—ãŸå†…å®¹ãŒä½¿ãˆãã†ã ãªã¨æ€ã„ã¾ã—ãŸã€‚
Cloudflare Workersã‚’GitHub Actionsã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã„äººã‚„ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼URLã‚’PRä¸Šã«ã‚³ãƒ¡ãƒ³ãƒˆã—ãŸã‚ŠGitHub Deploymentsã«ç™»éŒ²ã—ãŸã„äººã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
