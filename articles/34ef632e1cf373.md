---
title: "ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆé¸æŠãªã©ã§è¡Œã‚ã‚Œã‚‹ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã•ã‚Œãªã„ã‚ˆã†ã«ã—ãŸ"
emoji: "ğŸ™Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react"]
published: true
---

## å§‹ã‚ã«

Reactã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ‹¾ã†å ´åˆ`onClick`ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«è¨­å®šã™ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ mousedown ã—ã¦ã‹ã‚‰ mouseup ã™ã‚‹ã¾ã§ã«ã‚«ãƒ¼ã‚½ãƒ«ãŒç§»å‹•ã—ã¦ã‚‚åŒã˜è¦ç´ ã®ä¸Šã§ã‚ã‚Œã°ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãŒã•ã‚Œã¾ã™ã€‚

![](/images/prevent-clicks-by-drag/clicks-by-drag.gif)

é€šå¸¸ã§ã‚ã‚Œã°ã“ã®æŒ™å‹•ã§å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã§ã‚¹ãƒ¯ã‚¤ãƒ—ã—ãŸã„ã®ã«ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã•ã‚Œã¦ã—ã¾ã£ãŸã‚Šã€ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ”ãƒ¼ã—ãŸãã¦ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸã ã‘ãªã®ã«é¸æŠçŠ¶æ…‹ã«ãªã‚‹ã®ã¯é•å’Œæ„Ÿã§ã—ãŸã€‚

![](/images/prevent-clicks-by-drag/clicks-by-drag-in-original-carusel.gif)

![](/images/prevent-clicks-by-drag/clicks-by-drag-in-table.gif)

ãƒ†ãƒ¼ãƒ–ãƒ«ã¯é¸æŠã•ã‚ŒãŸã¨ã“ã‚ã§æ“ä½œã®é‚ªé­”ã‚’ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§æœ€æ‚ªå¤§ä¸ˆå¤«ã§ã™ãŒã€ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã¯è‡´å‘½çš„ã§ã™ã€‚ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚‚åŒã˜ã‚ˆã†ãªæŒ™å‹•ãŒèµ·ãã‚‹ã®ã‹[Swiper](https://swiperjs.com/react)ã§è©¦ã—ã¦ã¿ãŸã¨ã“ã‚ã€ãªã‚“ã¨ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’é˜²ã’ã¦ã„ã¾ã—ãŸã€‚

![](/images/prevent-clicks-by-drag/prevent-clicks-by-drag-in-swiper.gif)

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã©ã†ã‚„ã£ã¦ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‹ç´è§£ã‘ã°è‡ªå‰ã§ã‚‚è¨­å®šã§ãã‚‹ã¨æ€ã„ã€Swiperã®ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦å®Ÿéš›ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ããŸã®ã§å‚™å¿˜éŒ²ã¨ã—ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚

## Swiperã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ–ãƒ­ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯

çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã–ã£ãã‚Šä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ãŸã“ã¨ã«ã‚ˆã£ã¦å­è¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```ts:å­è¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹è¨­å®šã®å¤§æ 
el.addEventListener(
  'click',
  (e) => {
    if (/* ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ‘åˆ¶ã—ãŸã„æ™‚ */) {
      e.preventDefault();
      e.stopPropagation();
      e.stopImmediatePropagation();
    }
  },
  true
)
```

:::details å‚è€ƒã‚³ãƒ¼ãƒ‰

https://github.com/nolimits4web/swiper/blob/v11.1.14/src/core/events/index.mjs#L34-L37
https://github.com/nolimits4web/swiper/blob/v11.1.14/src/core/events/index.mjs#L72-L75
https://github.com/nolimits4web/swiper/blob/v11.1.14/src/core/events/onClick.mjs#L1-L11

:::

ã¡ãªã¿ã«ã“ã®ã€Œã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ‘åˆ¶ã—ãŸã„ã€ã¨ã„ã†ãƒ•ãƒ©ã‚°ãŒSwiperã«ã¯å­˜åœ¨ã™ã‚‹ã‚ˆã†ã§ã€ `preventClicks`ã¨`preventClicksPropagation`ã¨ã„ã†ãƒ•ãƒ©ã‚°ã§åˆ¶å¾¡ã§ãã¾ã—ãŸã€‚ã“ã‚Œã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒtrueã ã£ãŸã®ã§è¡¨ç¤ºã—ãŸã ã‘ã§ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã®ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’ãƒ–ãƒ­ãƒƒã‚¯ã§ãã¦ã„ãŸã‚ˆã†ã§ã™ã€‚

https://swiperjs.com/swiper-api#param-preventClicks

ã“ã®ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å¯Ÿã™ã‚‹ã«`e.stopPropagation`ã«ã‚ˆã£ã¦å­è¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€æ™®é€šã¯å­ã‹ã‚‰è¦ªã¸ã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹ã¯ãšã§é€†ã®å‹•ãã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ç¬¬3å¼•æ•°ã‚’trueã«ã—ã¦ã„ã‚‹ã®ãŒãƒŸã‚½ã«ãªã‚Šã¾ã™ã€‚ã“ã“ã‚’trueã«ã™ã‚‹ã¨ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§è¦ªã‹ã‚‰å­ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ãã“ã¨ã«ãªã‚‹ã®ã§ã€`e.stopPropagation`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã“ã‚Œä»¥ä¸Šå­ã¸æµã‚Œãªããªã‚Šã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/API/EventTarget/addEventListener#usecapture

ãƒãƒ–ãƒªãƒ³ã‚°ã¨ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒªãƒ³ã‚°ã«ã¤ã„ã¦ã®è©³ç´°ã¯ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

https://ja.javascript.info/bubbling-and-capturing
https://zenn.dev/antez/books/6da596a697aa86/viewer/d8a100

ãªãŠã€Reactã§ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ‹¾ã„ãŸã„å ´åˆã¯ `onClickCapture` ãªã© `~Capture` ã§è¨­å®šã§ãã¾ã™ã€‚è©¦ã—ã«ã“ã“ã§`stopPropagation`ã‚’å®Ÿè¡Œã—ãŸã‚‰å­è¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```tsx:Reactã§ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹ä¾‹
return (
  <div
    // è¦ªè¦ç´ ã§ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§ä¼æ’­ã‚’æ­¢ã‚ã‚‹
    onClickCapture={(event) => {
      event.stopPropagation();
    }}
  >
    <div
      onClick={() => {
        // ã“ã“ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªããªã£ãŸ
      }}
    />
  </div>
);
```

ã¡ãªã¿ã«ä½™è«‡ã§ã™ãŒã€Swiperã®å ´åˆã¯ mousedown ã‚¤ãƒ™ãƒ³ãƒˆãªã©ã‚‚ä¼æ’­ã‚’æŠ‘åˆ¶ã—ã¦ã„ãã†ã§ã€MUIã®Cardã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒªãƒƒã‚¯æ™‚ã®rippleã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚‚ç™ºç«ã—ãªããªã£ã¦ã„ã¾ã—ãŸã€‚ä»Šå›è‡ªå‰ã§å®Ÿè£…ã™ã‚‹éš›ã¯ãã“ã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã¤ã‚‚ã‚Šã¯ãªã„ã®ã§ã€å€‹åˆ¥ã§`disableRipple`ã‚’è¨­å®šã—ã¦rippleã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå‡ºãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

## Reactã§ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…

### ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹hooksã‚’å®Ÿè£…

Swiperã®å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯ã‚’å‚è€ƒã«ã€ä»Šå›ã¯hooksã§ã“ã®å®Ÿè£…ã‚’è¡¨ç¾ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚`onClickCapture`ãªã©ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿”ã™ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã‚ã‚Šã¾ã™ãŒã€å€‹äººçš„ã«ã¯DOMã«å¯¾ã—ã¦`addEventListener`ã—ãŸæ–¹ãŒåŒã˜DOMã«è¤‡æ•°ã®ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®šãŒå¿…è¦ã«ãªã£ãŸæ™‚ã«å›°ã‚‰ãªã„ã¨æ€ã£ãŸãŸã‚refã®ã¿è¿”ã—ã¦ãã‚Œã‚’å¯¾è±¡ã®DOMã«è¨­å®šã—ã¦è²°ã†æ–¹æ³•ã«ã—ã¾ã—ãŸã€‚
ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹ã‹ã¯ã‚¯ãƒªãƒƒã‚¯é–‹å§‹ã¨çµ‚äº†ã®å·®ã‚’ã¿ã¦ã€ãã®å·®ãŒä¸€å®šã®å€¤ã‚’è¶…ãˆãŸæ™‚ã«æ­¢ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ãŠã‚Šã€å…·ä½“çš„ã«ã‚³ãƒ¼ãƒ‰ã«è½ã¨ã™ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

```ts:ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’æ­¢ã‚ã‚‹hooks
import { useState, useEffect } from "react";

type UseStopPropagationClickByDragOption = {
  /**
   * ãƒ‰ãƒ©ãƒƒã‚°ã¨åˆ¤å®šã•ã‚Œã‚‹å¤‰åŒ–é‡ï¼ˆpxï¼‰
   * @default 0
   */
  dragThreshold?: number;
  /** æ©Ÿèƒ½ã‚’OFFã«ã™ã‚‹ã‹ */
  disabled?: boolean;
};

type UseStopPropagationClickByDragReturn = {
  /** ç›£è¦–å¯¾è±¡ã®DOMã®ref */
  ref: (element: HTMLElement | null) => void;
};

/**
 * ãƒ‰ãƒ©ãƒƒã‚°ã®å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã‚’æŠ‘åˆ¶ã™ã‚‹hooks
 */
export const usePreventClicksByDrag = ({
  dragThreshold = 0,
  disabled,
}: UseStopPropagationClickByDragOption = {}): UseStopPropagationClickByDragReturn => {
  const [element, setElement] = useState<HTMLElement | null>(null);

  useEffect(() => {
    if (element == null || disabled) {
      return;
    }

    /** ãƒ‰ãƒ©ãƒƒã‚°ã‚’ã—ãŸã‹ */
    let isDragged = false;
    /** ã‚¯ãƒªãƒƒã‚¯é–‹å§‹åº§æ¨™ */
    let startPos: { x: number; y: number } | null = null;
    const handlePointerDown = (event: PointerEvent) => {
      isDragged = false;
      startPos = {
        x: event.clientX,
        y: event.clientY,
      };
    };
    const handlePointerUp = (event: PointerEvent) => {
      if (startPos == null) {
        return;
      }

      // ãƒ‰ãƒ©ãƒƒã‚°ã®è·é›¢ãŒdragThresholdã‚’è¶…ãˆãŸã‚‰ãƒ‰ãƒ©ãƒƒã‚°åˆ¤å®šã«ã™ã‚‹
      const dx = startPos.x - event.clientX;
      const dy = startPos.y - event.clientY;
      if (Math.abs(dx) > dragThreshold || Math.abs(dy) > dragThreshold) {
        isDragged = true;
      }
      startPos = null;
    };
    const handlePointerLeave = () => {
      // ãƒã‚¤ãƒ³ã‚¿ãŒå¤–ã‚Œã¦ã—ã¾ã£ãŸæ™‚ã¯ã‚¯ãƒªãƒƒã‚¯é–‹å§‹åº§æ¨™ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
      startPos = null;
    };

    const handleClick = (event: MouseEvent) => {
      // ãƒ‰ãƒ©ãƒƒã‚°åˆ¤å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã‚‹
      if (isDragged) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
      }
    };

    element.addEventListener("pointerdown", handlePointerDown);
    element.addEventListener("pointerup", handlePointerUp);
    element.addEventListener("pointerleave", handlePointerLeave);
    element.addEventListener("click", handleClick);

    return () => {
      element.removeEventListener("pointerdown", handlePointerDown);
      element.removeEventListener("pointerup", handlePointerUp);
      element.removeEventListener("pointerleave", handlePointerLeave);
      element.removeEventListener("click", handleClick);
    };
  }, [element, disabled]);

  return {
    ref: setElement,
  };
};
```

`PointerEvents`ã¯ãƒã‚¦ã‚¹ã€ã‚¿ãƒƒãƒã€ãƒšãƒ³ãªã©ã®æ§˜ã€…ãªãƒ‡ãƒã‚¤ã‚¹ã«å¯¾å¿œã—ãŸã‚¤ãƒ™ãƒ³ãƒˆã§ã€è©³ç´°ã¯ã“ã¡ã‚‰ãªã©ã‚’ã”å‚è€ƒãã ã•ã„ã€‚ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ã®å ´åˆã€touchdownã‹ã‚‰touchupã®é–“ã§åº§æ¨™ãŒãšã‚Œã¦ã„ã‚‹ã¨clickã‚¤ãƒ™ãƒ³ãƒˆã¯ç™ºç«ã—ãªã•ãã†ãªæ„Ÿã˜ã§ã—ãŸãŒã€ä¸€å¿œãã¡ã‚‰ã‚‚è€ƒæ…®ã—ã¦ mousedown ã§ã¯ãªã pointerdown ãªã©ã®PointerEventsã‚’ä½¿ã„ã¾ã—ãŸã€‚

https://webfrontend.ninja/js-pointer-events/

ã¾ãŸå‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã«ã™ã‚‹ã“ã¨ã§å­è¦ç´ ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã‚‰ã‚Œã‚‹ã¨æ›¸ãã¾ã—ãŸãŒã€ä»Šå›ãã®è¨­å®šã‚’ã—ãªãã¦ã‚‚ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ­¢ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚Reactã®`on~`ã‚ˆã‚ŠDOMã«ç›´æ¥ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã—ãŸã‚‚ã®ã®æ–¹ãŒå„ªå…ˆã•ã‚Œã‚‹ã›ã„ãªã®ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ãŒã€ç¢ºä¿¡ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸€æ—¦ã“ã‚Œã§é€²ã‚ã¾ã™ãŒã€ã‚‚ã—å•é¡ŒãŒã‚ã‚Œã°`addEventListener`ã®ç¬¬3å¼•æ•°ã«trueã‚’å…¥ã‚Œã¦ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§è¡Œã†ã‚ˆã†ã«ã—ã‚ˆã†ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

### ä½œæˆã—ãŸhooksã‚’ä½¿ç”¨ã™ã‚‹

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è‡ªä½œã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã—ã¦ãã‚Œãã‚Œè¨­å®šã—ã¾ã™ã€‚
è‡ªä½œã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã«ã¤ã„ã¦ã¯æ—¢ã«refã‚’ä½¿ã£ã¦ã„ã‚‹ãŸã‚MUIãŒæä¾›ã—ã¦ã„ã‚‹`useForkRef`ã‚’ä½¿ã£ã¦è¤‡æ•°ã®refã‚’çµ±åˆã—ã¦ã‹ã‚‰æ¸¡ã™ã“ã¨ã§è¨­å®šã§ãã¾ã™ã€‚

```diff tsx:ã‚«ãƒ«ãƒ¼ã‚»ãƒ«ã«ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã¯ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’æŠ‘åˆ¶ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ 
 import { ReactNode } from 'react';
 import { useScratch } from 'react-use';
 import { clamp } from 'lodash-es';
 import { Box, IconButton, useForkRef } from '@mui/material';
 import ChevronLeftIcon from '@mui/icons-material/ChevronLeft';
 import ChevronRightIcon from '@mui/icons-material/ChevronRight';

+import { usePreventClicksByDrag } from '../hooks/usePreventClicksByDrag';

 /** æ¬¡ã¸é·ç§»ã™ã‚‹ã‹ã®é–¾å€¤ */
 const THRESHOLD = 10;

 export type CarouselProps<Item extends object> = {
   /** ç¾åœ¨è¡¨ç¤ºã—ã¦ã‚‹index */
   currentIndex: number;
   /** é …ç›®ãƒªã‚¹ãƒˆ */
   items: Item[];
   /** é …ç›®ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ã¨ãªã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã„ã‚‹ã‚­ãƒ¼å */
   itemIdKey: keyof Item;
   /** é«˜ã• */
   height?: string;
   /** å¹… */
   width?: string;
+  /** ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’æŠ‘åˆ¶ã•ã›ã‚‹ã‹ */
+  isPreventClicks?: boolean;
   /**
    * è¡¨ç¤ºã™ã‚‹indexå€¤ãŒå¤‰æ›´ã•ã‚Œã‚‹æ™‚
    * @param newIndex - æ–°ã—ã„è¡¨ç¤ºå…ˆindex
    */
   onChangeCurrentIndex: (newIndex: number) => void;
   /** ã‚«ãƒ«ãƒ¼ã‚»ãƒ«è¦ç´ ã®æç”» */
   children: (args: { item: Item }) => ReactNode;
 };

 export const Carousel = function <Item extends object>({
   currentIndex,
   items,
   itemIdKey,
   height = '100%',
   width = '100%',
+  isPreventClicks,
   onChangeCurrentIndex,
   children,
 }: CarouselProps<Item>) {
   /**
    * ç¾åœ¨ã®ä½ç½®ã‹ã‚‰deltaé‡ã ã‘ç§»å‹•ã™ã‚‹
    * @param delta - ç§»å‹•é‡
    */
   const addCurrentIndex = (delta: number) => {
     // ç¯„å›²å†…ã«åã¾ã‚‹ã‚ˆã†ã«èª¿æ•´ã—ãŸçµæœåŒã˜å€¤ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„
     const nextCurrentIndex = clamp(currentIndex + delta, 0, items.length - 1);
     if (nextCurrentIndex === currentIndex) {
       return;
     }
     // å€¤ãŒå¤‰ã‚ã£ãŸå ´åˆã‚„å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã™ã‚‹
     onChangeCurrentIndex(nextCurrentIndex);
   };

   const [refScratch, { isScratching, dx }] = useScratch({
     onScratchEnd: ({ dx = 0 }) => {
       if (dx < -THRESHOLD) {
         addCurrentIndex(1);
       } else if (dx > THRESHOLD) {
         addCurrentIndex(-1);
       }
     },
   });
+  const { ref: refStopPropagationClickByDrag } = usePreventClicksByDrag({
+    dragThreshold: THRESHOLD,
+    disabled: isPreventClicks === false,
+  });

+  const handleRef = useForkRef(refScratch, refStopPropagationClickByDrag);

   return (
     <Box
+      ref={handleRef}
       sx={{ position: 'relative', height, width, overflow: 'hidden' }}
     >
       {items.map((item, index) => {
         return (
           <Box
             key={String(item[itemIdKey])}
             style={{
               position: 'absolute',
               top: '50%',
               left: '50%',
               transform: `translate3d(${
                 -50 + (-currentIndex + index) * 100
               }%, -50%, 0) translate3d(${dx ?? 0}px, 0, 0)`,
               transition: isScratching ? 'none' : 'transform 0.25s',
             }}
           >
             {children({ item })}
           </Box>
         );
       })}
       <IconButton
         sx={{
           position: 'absolute',
           top: '50%',
           left: 0,
           transform: 'translate(0, -50%)',
         }}
         disabled={currentIndex <= 0}
         onClick={() => {
           addCurrentIndex(-1);
         }}
       >
         <ChevronLeftIcon fontSize="large" />
       </IconButton>
       <IconButton
         sx={{
           position: 'absolute',
           top: '50%',
           right: 0,
           transform: 'translate(0, -50%)',
         }}
         disabled={currentIndex + 1 >= items.length}
         onClick={() => {
           addCurrentIndex(1);
         }}
       >
         <ChevronRightIcon fontSize="large" />
       </IconButton>
     </Box>
   );
 };
```

ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¤ã„ã¦ã¯MUIã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒè¡Œå˜ä½ã§è¨­å®šã™ã‚‹ã“ã¨ãŒã§ããªã‹ã£ãŸãŸã‚ã‚¬ãƒƒãƒ„ãƒªãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã«è¨­å®šã—ã¾ã—ãŸã€‚ã“ã®å½±éŸ¿ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚‚ãƒ‰ãƒ©ãƒƒã‚°åˆ¤å®šã•ã‚Œã‚‹ã¨ã‚¯ãƒªãƒƒã‚¯ã§ããªããªã‚Šã¾ã™ãŒãã‚‚ãã‚‚ãƒ‰ãƒ©ãƒƒã‚°ã£ã½ã„å‹•ãã®ã‚¯ãƒªãƒƒã‚¯ã§ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹å¿…è¦ãŒãªã„ã¨æ€ã†ã®ã§ãã“ã¾ã§æ°—ã«ãªã‚‰ãªã„ã¨æ€ã„ã¾ã™ã€‚
è¨­å®šã‚ã‚Šãªã—ã®æŒ™å‹•ã‚’æ¯”è¼ƒã§ãã‚‹ã‚ˆã†ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚‚ç”¨æ„ã—ã¾ã—ãŸã€‚

```diff tsx:ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã¯ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’æŠ‘åˆ¶ã™ã‚‹æ©Ÿèƒ½ã‚’è¿½åŠ 
 const TableSection: FC = () => {
+  const [isPreventClicks, setIsPreventClicks] = useState(false);
+  const { ref } = usePreventClicksByDrag({
+    dragThreshold: 5,
+    disabled: isPreventClicks === false,
+  });

   return (
     <Box>
+      <FormControlLabel
+        control={
+          <Checkbox
+            checked={isPreventClicks}
+            onChange={(_, checked) => {
+              setIsPreventClicks(checked);
+            }}
+          />
+        }
+        label="ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã«ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šã‚’æŠ‘åˆ¶ã™ã‚‹"
+      />
       <Typography fontWeight="bold">ãƒ†ãƒ¼ãƒ–ãƒ«</Typography>
       <DataGrid
+        ref={ref}
         rows={CARD_ITEMS}
         columns={[
           { field: 'id', headerName: 'ID', width: 80 },
           { field: 'title', headerName: 'ã‚¿ã‚¤ãƒˆãƒ«' },
           { field: 'description', headerName: 'èª¬æ˜' },
         ]}
         checkboxSelection
         disableColumnFilter
         disableColumnMenu
         disableColumnSorting
         hideFooter
       />
     </Box>
   );
 };
```

### å‹•ä½œçµæœã¨æ¤œè¨¼ã‚³ãƒ¼ãƒ‰

ä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ã§å‹•ã‹ã—ãŸã¨ã“ã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‰ãƒ©ãƒƒã‚°æ™‚ã¯ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ‘åˆ¶ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ‰

![](/images/prevent-clicks-by-drag/switch-prevent-clicks-by-drag-in-original-carousel.gif)
![](/images/prevent-clicks-by-drag/switch-prevent-clicks-by-drag-in-table.gif)

ä»Šå›æ¤œè¨¼ã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®StackBlitzã«ã‚ã‚Šã¾ã™ã®ã§ã€è©³ç´°ã®ã‚³ãƒ¼ãƒ‰ã‚„å‹•ä½œã‚’ç¢ºèªã—ãŸã„æ–¹ã¯æ˜¯éã”å‚ç…§ãã ã•ã„ã€‚StackBlitzã§ã¯ã¤ã„ã§ã«Swiperã‚‚è¼‰ã›ã¦ã„ã¾ã™ã€‚

@[stackblitz](https://stackblitz.com/edit/vitejs-vite-qnkxd7?ctl=1&embed=1&file=src%2FApp.tsx&view=preview)

## çµ‚ã‚ã‚Šã«

ä»¥ä¸ŠãŒãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹æ–¹æ³•ã§ã—ãŸã€‚è¦ªã‹ã‚‰å­ã®ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºç«ã‚’æŠ‘åˆ¶ã§ãã‚‹ã“ã¨ãŒç›®ã‹ã‚‰é±—ã§ã—ãŸãŒã€ã“ã‚Œã«ã‚ˆã£ã¦è¨­å®šãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã£ã¦è‰¯ã‹ã£ãŸã§ã™ğŸ˜Šã€€ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã¨ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã—ã¦æ„å›³ã—ãªã„ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¦ã—ã¾ã†æ™‚ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚
